## 61850 profile {#message-specification}

IEC61850 interface profile to meet the RfG guidelines. This profile is inspired by BAP (Basic application profile/61850-7-6).

## Functional description
Due to an increasing adoption of renewable energy sources, electricity production moves slowly from big production plants to local electricity production. Think of solar panels for example. This can lead to local problems in the grid. To deal with these problems the local system operator needs to switch off or reduce the amount of electricity production (only when needed). Besides reducing load it also needs to know things about the electricity production (e.g. actual electricty production) to predict congestion. This 61850 profile will be used for controlling and monitoring distributed energy resources.

## Description of Use Case and associated roles/actors
![Actor overview](/assets/61850Actors-overview.png)

## Use Case
![use case overview](/assets/61850Monitor-and-control-DER.png)

## Sequence diagram
![sequence](/assets/61850Sequence-diagram-typical-interactions.png)

## Logical Architecture

Logical architecture monitoring function
![Logical architecture monitoring function](/assets/Logical_Architecture_DERmonitoringfunction.png)

Logical architecture control function
![Logical architecture control function](/assets/Logical_Architecture_DERcontrolfunction.png)



### Description of data model per actor
All field descriped in the tables are mandatory (by the IEC61850 standard or required to meet this specification). All IEC61850 mandatory field should be includes in the device.

**DRCT for local DER control function**

|Data object name |Common data class | Attribute(s) |Default value | Comment |
|:--|:--|:--|:--|:--|
|DERNum| ING|stVal||Number of electricity production (DER) units connected to controller. 1 of only 1 production unit is connected or is fysical .|
|DERTyp| ENG|steVal|| Type of DER unit managed by controller.|
|MaxWLim| ASG|setMag||Nominal max output power at controller|
|MaxVArLim| ASG|setMag||Nominal max output reactive power at controller|
|Wmax|ASG|setMag||Maximal output of the electricity production unit.|
|Vref| ASG|setMag||Reference voltage for functions using grid voltage as input|
|OutPFSet|ASG|setMag||Setpoint for maintaining fixed power factor.|
	
	
**LPHD**

|Data object name| Common data class| Attribute |Default value | Comment |
|:--|:--|:--|:--|:--|
|PhyNam| DPL|vendor||Vendor of the physical device.|
| | |swRev||Software revision of the physical device.|
| | |model||Software revision of the LN.|
| | |mRID||mRID of the physical device. UUIDv4 generated by vendor (?).|
| | |serNum||Serialnumber of de physical device|
| | |primeOper||Primary operator of device. STRING256(can we use this for the QR URL?)|
|PhyHealth| ENS|stVal||Physical device health|
| | |q||Quality|
| | |t||Timestamp|
|Proxy|	SPS| stVal | False | Proxy is not allowed. (?)|
| | |q||Quality|
| | |t||Timestamp|
|PwrUp| SPS| stVal | | Power-up detected |
| | |q||Quality|
| | |t||Timestamp|
	
**LLN0**

|Data object name|Common data class|Attribute | Default value | Comment |
|:--|:--|:--|:--|:--|	
|NamPlt	|LPL|vendor||Vendor of the LN. Mandatory by IEC61850. | 
| | |swRev||Software revision of the LN.|


**FSCH for Schedule function**
Todo: Number of schedules?

|Data object name|Common data class|Attribute | Default value | Comment |
|:--|:--|:--|:--|:--|
|SchdSt	|ENS|stVal||State of this schedule|
| | |q||Quality|
| | |t||Timestamp|
|SchdEntr |INS|stVal||The current schedule entry of a running schedule.|
| | |q||Quality|
| | |t||Timestamp|
|Beh| ENS|stVal||
| | |q||Quality|
| | |t||Timestamp|
|VldReq| SPC|ctlModel||Operating with value true initiates validate transition request|
|EnaReq| SPC|ctlModel||Operating with value true enable validate transition request.|
|EdtReq	|SPC|ctlModel||Operating with value true edit validate transition request.|
|DsaReq| SPC|ctlModel||Operating with value true disable validate transition request.|
|SchdPrio| ING|setVal||The priority of this schedule.|
|NumEntr| ING|setVal||The number of schedule entries that are valid.|
|SchdIntv| ING|setVal||The schedule interval duration in time entities as specified in the SchdIntv.units.SIUnit.|
|ValASG| ASG|setMag||current value output as MV: Number of Values allowed?|
|StrTm|	TSG|setTm||Start time of the schedule in UTC time.|
|||setCal||
|IntvPer| ING|setVal||The periodicity interval duration in entities as specified in IntvTyp; if the value is 0, the schedule shall not be repeated periodically.|
|IntvTyp| ENG|stVAl||Interval type to define the periodicity.|
|EvTrg|	SPG|setVal||If true, the change of the schedule to the running and activated state is triggered by an external event and not by the start time.|
|InSyn|	ORG|setSrcRef||Object reference of the external trigger if the schedule is triggered by an event.|
|SchdReuse|SPG|setVal||If true, once terminated or disabled, the schedule will change to the validated state, otherwise it will change to the not ready state.|
	
	
**FSCC for Schedule control function**

|Data object name|Common data class| Attribute | Default value | Comment |
|:--|:--|:--|:--|:--|
|ActSchdRef| ORS|stVal||Indication of which schedule is active as an object reference.|
| | |q||Quality|
| | |t||Timestamp|
|CrlEnt| ORG|setSrcRef||Object reference to the entity controlled by the schedule.|
|Schd| ORG|||Object reference of schedule n (an LN reference to the LN of class FSCH). (maximal numer of schedules?)|

**MMXU for DER monitor function**
This logical node measures the actual output of the electricity production unit.

|Data object name|Common data class| Attribute |Default value | Comment |
|:--|:--|:--|:--|:--|
|TotW| MV|mag||
| | |q||Quality|
| | |t||Timestamp|
|TotVAr| MV|mag||
| | |q||Quality|
| | |t||Timestamp|

**MMXU for Measurement calculation function**

These Logical nodes can be used to calculate the averages etc. These LN's should connect to the actual MMXU who does the non-calculated measurements.

|Data object name|Common data class| Attribute |Default value | Comment |
|:--|:--|:--|:--|:--|
|ClcMth | ENG|mag|MAX| Calculation Method of statistical data|
| | |q||Quality|
| | |t||Timestamp|
|ClcMod | ENG |mag|PERIOD|Calculation mode|
| | |q||Quality|
| | |t||Timestamp|
|ClcIntvTyp |ING| || Calculation interval type. |
|ClcIntvPer|ING| || In case ClcIntvTyp equals to MS, PER-CYCLE, CYCLE, DAY, WEEK, MONTH, YEAR, number of units to consider to calculate the calculation interval duration | 
|InSyn|ORG|||Object reference to the source of the external synchronization signal for the calculation interval |
|CLCSrc|ORG|||Object reference to source logical node |
|ClcExp|SPS|||Calculation period expired |
|TotW| MV |mag||Active power value|
| | |q||Quality|
| | |t||Timestamp|

The following measurements should be build using the MMXU above:
* Minimal Power (P) during measurement interval t
* Maximal Power (P) during measurement interval t
* Average Power (P) in each 24 hours
* Average Power (P) during the day* (under discussion)
* Average Power (P) during the night* (under discussion)
* Average Power in total during interval t, measured in a resolution of 30 minute values**.(under discussion)

**MMTR for DER monitor function**

|Data object name|Common data class| Attribute |Default value | Comment |
|:--|:--|:--|:--|:--|
|TotWh| BCR |ActVal||Sending the kWh every X minutes allow the system operator to calcuate the de daily average etc |
| | |q||Quality|
| | |t||Timestamp|
| | |PulsQty||Timestamp|

## Communication Services
The following services should be supported by the electricity production unit.

Association
* Associate
* Release
* Abort

Server
* GetServerDirectory

Locigal Device
* GetLogicalDeivceDirectory

Logical Node
* GetLogicalNodeDirectory

Data
* GetDataValues
* SetDataValues
* GetDataDefinition

Data set
* GetDataSetValues
* SetDataSetValues

Reporting (buffered and unbuffered)
* Report
* GetURCBValues
* SetURCBValues

Control
* Operate

## keepalive
According 61850-8-2, XEP 0199 can be used to build a keep alive signal.
